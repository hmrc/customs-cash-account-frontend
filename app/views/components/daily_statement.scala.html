@*
 * Copyright 2021 HM Revenue & Customs
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *@

@import helpers.Formatters
@import views.html.components.transaction_row
@import views.html.components.cash_transactions_payment_header

@this(
        transactionRow : transaction_row,
        paymentHeader : cash_transactions_payment_header
)

@(dailyStatement: CashDailyStatement)(implicit messages: Messages)

<h3 class="govuk-heading-m  govuk-!-padding-top-4 govuk-!-margin-bottom-1" id="@{s"heading-${dailyStatement.date}"}" aria-describedby="@{s"balance-${dailyStatement.date}"}"> @{
    Formatters.dateAsDayMonthAndYear(dailyStatement.date)
}</h3>
<p class="govuk-body govuk-!-margin-bottom-2" id="@{s"balance-${dailyStatement.date}"}">
    @messages("cf.cash-account.detail.closing-balance", Formatters.formatCurrencyAmount(dailyStatement.closingBalance))
</p>

@if(dailyStatement.declarations.nonEmpty){
    <table class="govuk-table hmrc-responsive-table govuk-!-margin-bottom-6" id="@{s"table-${dailyStatement.date}"}">
        <caption class="govuk-visually-hidden">
        @messages("cf.cash-account.detail.payments-caption", Formatters.dateAsDayMonthAndYear(dailyStatement.date))
        </caption>
        @paymentHeader()
        <tbody class="govuk-table__body">
        @for(declaration <- dailyStatement.declarations.sorted) {
            <tr class="govuk-table__row">
                <th class="govuk-table__header govuk-!-font-weight-regular" scope="row">
                    <span class="hmrc-responsive-table__heading" aria-hidden="true">@messages("cf.cash-account.detail.mrn")</span>
                    @{declaration.movementReferenceNumber}
                </th>
                <td class="govuk-table__cell">
                    <span class="hmrc-responsive-table__heading" aria-hidden="true">@messages("cf.cash-account.detail.ucr")</span>
                    @{declaration.declarantReference.getOrElse(" ")}
                </td>
                <td class="govuk-table__cell">
                    <span class="hmrc-responsive-table__heading" aria-hidden="true">
                        @messages("cf.cash-account.detail.declarant")
                        @messages("cf.cash-account.detail.eori")
                    </span>
                    @{declaration.declarantEori}
                </td>
                <td class="govuk-table__cell govuk-table__cell--numeric amount">
                    <span class="hmrc-responsive-table__heading" aria-hidden="true">@messages("cf.cash-account.detail.amount")</span>
                    @{Formatters.formatCurrencyAmount(declaration.amount)}
                </td>
            </tr>
        }
        </tbody>
    </table>
}

@if(dailyStatement.hasTransactions){
    <table class="govuk-table hmrc-responsive-table govuk-!-margin-bottom-6" id="@{s"transaction-table-${dailyStatement.date}"}">
        <caption class="govuk-visually-hidden">
        @messages("cf.cash-account.detail.transactions-caption", Formatters.dateAsDayMonthAndYear(dailyStatement.date))
        </caption>
        <thead>
            <tr class="govuk-table__row">
                <th class="govuk-table__header" scope="col">
                @messages("cf.cash-account.detail.transactions")
                </th>
                <th class="govuk-table__header govuk-table__header--numeric">
                @messages("cf.cash-account.detail.amount")
                </th>
            </tr>
        </thead>
        <tbody>
        @for(withdrawal <- dailyStatement.withdrawals) {
            @transactionRow(
                messages("cf.cash-account.detail.transactions"),
                s"${messages("cf.cash-account.detail.withdrawal")} ${
                    withdrawal.bankAccountNumberLastFourDigits.fold(""){
                        suffix => messages("cf.cash-account.detail.withdrawal.account-ending", suffix)
                    }
                }",
                messages("cf.cash-account.detail.amount"),
                Formatters.formatCurrencyAmount(withdrawal.amount)
            )
        }
        @for(topup <- dailyStatement.topUps){
            @transactionRow(
                messages("cf.cash-account.detail.transactions"),
                messages("cf.cash-account.detail.top-up"),
                messages("cf.cash-account.detail.amount"),
                s"+${Formatters.formatCurrencyAmount(topup.amount)}"
            )
        }
        @for(transferOut <- dailyStatement.transfersOut){
            @transactionRow(
                messages("cf.cash-account.detail.transactions"),
                messages("cf.cash-account.detail.transfer-out"),
                messages("cf.cash-account.detail.amount"),
                Formatters.formatCurrencyAmount(transferOut.amount)
            )
        }
        @for(transferIn <- dailyStatement.transfersIn){
            @transactionRow(
                messages("cf.cash-account.detail.transactions"),
                messages("cf.cash-account.detail.transfer-in"),
                messages("cf.cash-account.detail.amount"),
                s"+${Formatters.formatCurrencyAmount(transferIn.amount)}"
            )
        }
        </tbody>
    </table>
}